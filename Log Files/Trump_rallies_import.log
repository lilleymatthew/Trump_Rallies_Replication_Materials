---------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\mlilley\Dropbox\Trump Rallies\Log Files/Trump_rallies_import.log
  log type:  text
 opened on:  12 Sep 2019, 12:22:54

. set more off

. clear all

. macro drop _all

. 
. *******************************************************************************
. * (1) Load data and Import
. *******************************************************************************
. 
. ** Trump Rallies
. 
. import delimited "Cleaned/rally_counties_merged.csv", delimiter(",") clear 
(8 vars, 397 obs)

. 
. gen rallydate = date(date,"DMY")

. gen monthyear = mofd(rallydate)

. format monthyear %tm

. 
. gen fips = state_fips * 1000 + countyfips

. 
. * Collapse to Month-County Level
. drop if year(rallydate) != 2016
(113 observations deleted)

. 
. gen count = 1

. collapse (count) rallycount = count, by(fips monthyear state state_fips countyname countyfips)

. 
. save Intermediate/Trump_rallies.dta, replace
file Intermediate/Trump_rallies.dta saved

. 
. 
. ** Clinton Rallies
. 
. import delimited "Cleaned/clinton_rally_counties_merged.csv", delimiter(",") clear 
(7 vars, 127 obs)

. 
. drop if candidatesinvolved == "Kaine"
(59 observations deleted)

. 
. gen rallydate = date(date,"DMY")

. gen monthyear = mofd(rallydate)

. format monthyear %tm

. 
. gen fips = state_fips * 1000 + countyfips

. 
. * Collapse to Month-County Level
. drop if year(rallydate) != 2016
(0 observations deleted)

. 
. gen count = 1

. collapse (count) rallycount = count, by(fips monthyear state state_fips countyname countyfips)

. 
. save Intermediate/Clinton_rallies.dta, replace
file Intermediate/Clinton_rallies.dta saved

. 
. 
. ** ADL Hate Incidents
. import delimited "Cleaned/ADL_data_counties.csv", delimiter(",") clear 
(12 vars, 1,321 obs)

. 
. gen incidentdate = mdy(month,01,2016)

. gen monthyear = mofd(incidentdate)

. format monthyear %tm

. 
. * Fill State FIPS Data
. bysort state_abbrev (state_fips): replace state_fips = state_fips[_n-1] if missing(state_fips)
(302 real changes made)

. 
. gen fips = state_fips * 1000 + countyfips
(2 missing values generated)

. 
. * Collapse to Month-County Level
. gen count = 1

. collapse (count) incidentcount = count, by(fips monthyear state state_fips countyname countyfips)

. 
. save Intermediate/hate_incidents.dta, replace
file Intermediate/hate_incidents.dta saved

. 
. 
. ** SPLC Hate Groups
. import delimited "Cleaned/splc-hate-groups-2016.csv", delimiter(",") clear 
(8 vars, 917 obs)

. 
. gen count = 1

. collapse (count) hategroupscount = count, by(state)

. 
. save Intermediate/hate_groups.dta, replace
file Intermediate/hate_groups.dta saved

. 
. 
. ** Jewish Population (and Total Population)
. import delimited "Cleaned/N-JewishMapUS_2011_MapData.csv", delimiter(",") clear 
(22 vars, 3,221 obs)

. 
. keep fipscode bermanest censuspop10

. 
. * Remove Puerto Rico
. drop if fipscode >= 72000
(78 observations deleted)

. 
. * Reset Placeholder Codes to Zero Population
. *replace bermanest = 0 if bermanest == 49 | bermanest == 101
. 
. * Per Capita Jewish Population
. gen jewishpopshare = bermanest / censuspop10

. 
. keep jewishpopshare censuspop10 fipscode

. rename fipscode fips

. 
. save Intermediate/jewish_population.dta, replace
file Intermediate/jewish_population.dta saved

. 
. 
. ** College Education
. import delimited "Cleaned/nhgis0001_ds215_20155_2015_county.csv", delimiter(",") clear 
(88 vars, 3,220 obs)

. 
. gen fips = statea * 1000 + countya

. 
. * Remove Puerto Rico
. drop if statea == 72
(78 observations deleted)

. 
. * Per Capita College Attainment (Bachelor's Degree or Higher)
. gen collegeshare = (admze022 + admze023 + admze024 + admze025) / admze001

. 
. keep state statea county countya fips collegeshare

. 
. rename (countya statea) (countyfips state_fips)

. 
. save Intermediate/college_educated.dta, replace
file Intermediate/college_educated.dta saved

. 
. 
. ** 2012 Presidential Election (Most states)
. import delimited "Cleaned/County_Presidential_Election_Data_2012_0_0_2.csv", delimiter(",") clear  
(36 vars, 3,114 obs)

. 
. destring state_fips countyfips willardmittromney totalvote, force replace
state_fips: contains nonnumeric characters; replaced as byte
(1 missing value generated)
countyfips: contains nonnumeric characters; replaced as int
(1 missing value generated)
willardmittromney: contains nonnumeric characters; replaced as long
(1 missing value generated)
totalvote: contains nonnumeric characters; replaced as long
(1 missing value generated)

. 
. gen fips = state_fips * 1000 + countyfips
(1 missing value generated)

. 
. * Romney Vote Share
. gen gop2012share = willardmittromney / totalvote
(1 missing value generated)

. 
. keep fips state_fips countyfips gop2012share

. 
. tempfile Returns_Minus_Alaska

. 
. save "`Returns_Minus_Alaska'"
file C:\Users\mlilley\AppData\Local\Temp\ST_5dbc_000001.tmp saved

. 
. 
. ** 2012 Presidential Election (Alaska)
. import delimited "Cleaned/Alaska_Borough_Returns_2012.csv", delimiter(",") clear
(6 vars, 29 obs)

. 
. replace romney = subinstr(romney,"%","",.)
(29 real changes made)

. 
. destring romney, replace
romney: all characters numeric; replaced as double

. 
. replace romney = romney/100
(29 real changes made)

. 
. rename romney gop2012share

. 
. gen fips = state_fips * 1000 + countyfips

. 
. keep fips state_fips countyfips gop2012share

. 
. append using "`Returns_Minus_Alaska'"

. 
. save Intermediate/presidential_election.dta, replace
file Intermediate/presidential_election.dta saved

. 
. 
. ** 2015 UCR Crime Data
. use "Cleaned/UCR_2015_County_Data", clear

. 
. keep fips state_fips countyfips *rate

. 
. save Intermediate/crime_data, replace
file Intermediate/crime_data.dta saved

. 
. 
. ** 2015 UCR Hate Crime Data
. use "Cleaned/UCR_2016_County_Hate_Crimes_Monthly", clear

. 
. keep fips state_fips countyfips hate_crimes month

. 
. gen crimedate = mdy(month,01,2016)

. gen monthyear = mofd(crimedate)

. format monthyear %tm

. 
. save Intermediate/hate_crimes, replace
file Intermediate/hate_crimes.dta saved

. 
. 
. ** Census Regions
. import delimited "Cleaned/state-geocodes-v2017.csv", delimiter(",") varnames(6) clear
(4 vars, 64 obs)

. 
. drop if statefips == 0
(13 observations deleted)

. 
. rename statefips state_fips

. 
. label define censusregions_lbl 1 "Northeast" 2 "Midwest"  3 "South" 4 "West", add

. label values region censusregions_lbl

. 
. save Intermediate/census_regions.dta, replace
file Intermediate/census_regions.dta saved

. 
. 
. ** Taco Bell Locations
. use "Cleaned/Taco_Bell_Locations", clear

. 
. save Intermediate/taco_bell_locations, replace
(note: file Intermediate/taco_bell_locations.dta not found)
file Intermediate/taco_bell_locations.dta saved

. 
. 
. *******************************************************************************
. * (2) End of file
. *******************************************************************************
. 
. log close
      name:  <unnamed>
       log:  C:\Users\mlilley\Dropbox\Trump Rallies\Log Files/Trump_rallies_import.log
  log type:  text
 closed on:  12 Sep 2019, 12:22:57
---------------------------------------------------------------------------------------------------------
